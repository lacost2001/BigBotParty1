{% extends "base.html" %}
{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | Discord Bot{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="text-neon mb-1">
                    <i class="fas fa-tachometer-alt me-3"></i>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </h1>
                <p class="text-secondary mb-0">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username or session.user.username }}!</p>
            </div>
            <div class="d-flex gap-2">
                <a href="https://discord.com/oauth2/authorize?client_id=1416183475798540368&permissions=8&scope=bot+applications.commands" 
                   target="_blank" class="btn btn-success">
                    <i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                </a>
                <span class="badge bg-success fs-6 online-status">
                    <i class="fas fa-circle me-1" style="color: #00ff88; animation: pulse 2s infinite;"></i>–û–Ω–ª–∞–π–Ω
                </span>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-server fa-2x text-neon"></i>
                </div>
                <h4 class="text-neon">{{ available_guilds|length if available_guilds else 0 }}</h4>
                <p class="text-secondary mb-0">–î–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-plus-circle fa-2x text-warning"></i>
                </div>
                <h4 class="text-warning">{{ user_only_guilds|length if user_only_guilds else 0 }}</h4>
                <p class="text-secondary mb-0">–ù—É–∂–µ–Ω –±–æ—Ç</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-calendar-alt fa-2x text-success"></i>
                </div>
                <h4 class="text-success">{{ bot_stats.active_events if bot_stats.active_events else '0' }}</h4>
                <p class="text-secondary mb-0">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card h-100">
            <div class="card-body text-center">
                <div class="mb-3">
                    <i class="fas fa-users fa-2x text-info"></i>
                </div>
                <h4 class="text-info">{{ bot_stats.online_members if bot_stats.online_members else '0' }}</h4>
                <p class="text-secondary mb-0">
                    –û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    {% if bot_stats.total_members %}
                        <br><small class="text-muted">–∏–∑ {{ bot_stats.total_members }}</small>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

{% if available_guilds %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">
                    <i class="fas fa-check-circle text-success me-2"></i>
                    –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
                </h3>
                <span class="badge bg-success">{{ available_guilds|length }} —Å–µ—Ä–≤–µ—Ä(–æ–≤)</span>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    {% for guild in available_guilds %}
                    <div class="col-lg-4 col-md-6">
                        <div class="card server-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    {% if guild.icon %}
                                        <img src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png" 
                                             alt="Server Icon" class="rounded-circle me-3" width="48" height="48">
                                    {% else %}
                                        <div class="bg-gradient rounded-circle d-flex align-items-center justify-content-center me-3" 
                                             style="width: 48px; height: 48px;">
                                            <i class="fas fa-hashtag text-white"></i>
                                        </div>
                                    {% endif %}
                                    <div class="flex-grow-1">
                                        <h5 class="mb-1">{{ guild.name }}</h5>
                                        <small class="text-success">
                                            <i class="fas fa-circle me-1"></i>–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <a href="/guild/{{ guild.id }}" class="btn btn-primary">
                                        <i class="fas fa-cog me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–º
                                    </a>
                                    <div class="row g-1">
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/templates" class="btn btn-outline-primary btn-sm w-100">
                                                <i class="fas fa-file-alt me-1"></i>–®–∞–±–ª–æ–Ω—ã
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/events" class="btn btn-outline-primary btn-sm w-100">
                                                <i class="fas fa-calendar me-1"></i>–°–æ–±—ã—Ç–∏—è
                                            </a>
                                        </div>
                                        <div class="col-12">
                                            <a href="/guild/{{ guild.id }}/events/guest" class="btn btn-success btn-sm w-100">
                                                <i class="fas fa-plus-circle me-1"></i>–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/submissions" class="btn btn-outline-success btn-sm w-100">
                                                <i class="fas fa-user-plus me-1"></i>–ó–∞—è–≤–∫–∏
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/recruit" class="btn btn-outline-info btn-sm w-100">
                                                <i class="fas fa-star me-1"></i>–†–µ–∫—Ä—É—Ç–∏–Ω–≥
                                            </a>
                                        </div>
                                    </div>
                                    <div class="row g-1 mt-1">
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/shop" class="btn btn-outline-warning btn-sm w-100">
                                                <i class="fas fa-shopping-cart me-1"></i>–ú–∞–≥–∞–∑–∏–Ω
                                            </a>
                                        </div>
                                        <div class="col-6">
                                            <a href="/guild/{{ guild.id }}/stats" class="btn btn-outline-secondary btn-sm w-100">
                                                <i class="fas fa-chart-bar me-1"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                            </a>
                                        </div>
                                        <div class="col-12">
                                            <a href="/guild/{{ guild.id }}/role-settings" class="btn btn-outline-warning btn-sm w-100">
                                                <i class="fas fa-users-cog me-1"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if needs_bot_guilds %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3 class="mb-0">
                    <i class="fas fa-plus-circle text-warning me-2"></i>
                    –°–µ—Ä–≤–µ—Ä—ã –±–µ–∑ –±–æ—Ç–∞
                </h3>
                <span class="badge bg-warning text-dark">{{ needs_bot_guilds|length }} —Å–µ—Ä–≤–µ—Ä(–æ–≤)</span>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –Ω–∞ —ç—Ç–∏ —Å–µ—Ä–≤–µ—Ä—ã</strong> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.
                </div>
                
                <div class="row g-4">
                    {% for guild in needs_bot_guilds %}
                    <div class="col-lg-4 col-md-6">
                        <div class="card server-card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    {% if guild.icon %}
                                        <img src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png" 
                                             alt="Server Icon" class="rounded-circle me-3" width="48" height="48">
                                    {% else %}
                                        <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center me-3" 
                                             style="width: 48px; height: 48px;">
                                            <i class="fas fa-hashtag text-white"></i>
                                        </div>
                                    {% endif %}
                                    <div class="flex-grow-1">
                                        <h5 class="mb-1">{{ guild.name }}</h5>
                                        <small class="text-warning">
                                            <i class="fas fa-exclamation-triangle me-1"></i>–ë–æ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <a href="/guild/{{ guild.id }}/invite" class="btn btn-warning">
                                        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if not available_guilds and not needs_bot_guilds %}
<div class="row">
    <div class="col-12">
        <div class="card text-center">
            <div class="card-body py-5">
                <div class="mb-4">
                    <i class="fas fa-server fa-4x text-secondary"></i>
                </div>
                <h3 class="text-secondary mb-3">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤</h3>
                <p class="text-secondary mb-4">
                    –£ –≤–∞—Å –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞.<br>
                    –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º —Å–µ—Ä–≤–µ—Ä–µ.
                </p>
                <a href="https://discord.com/channels/@me" target="_blank" class="btn btn-discord">
                    <i class="fab fa-discord me-2"></i>–û—Ç–∫—Ä—ã—Ç—å Discord
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="fas fa-bolt text-warning me-2"></i>
                    –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h3>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <a href="/admin" class="btn btn-outline-primary w-100">
                            <i class="fas fa-tools me-2"></i>
                            –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                        </a>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-success w-100" onclick="refreshStats()">
                            <i class="fas fa-sync-alt me-2"></i>
                            –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                    <div class="col-md-3">
                        <a href="https://discord.com/developers/applications" target="_blank" class="btn btn-outline-info w-100">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Dev Portal
                        </a>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-warning w-100" onclick="showHelp()">
                            <i class="fas fa-question-circle me-2"></i>
                            –ü–æ–º–æ—â—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function refreshStats() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
    btn.disabled = true;
    
    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

function showHelp() {
    const helpText = `
    ü§ñ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Discord –±–æ—Ç–æ–º
    
    ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã - —Å–µ—Ä–≤–µ—Ä—ã –≥–¥–µ –±–æ—Ç —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä—ã –±–µ–∑ –±–æ—Ç–∞ - –Ω–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞" –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    
    üîß –§—É–Ω–∫—Ü–∏–∏:
    ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
    ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–±—ã—Ç–∏–π  
    ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚Ä¢ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    
    üí° –°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ "–°–µ—Ä–≤–µ—Ä—ã" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏.
    `;
    
    alert(helpText);
}

// –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const counters = document.querySelectorAll('.card-body h4');
    counters.forEach(counter => {
        const target = parseInt(counter.textContent);
        if (!isNaN(target)) {
            let current = 0;
            const increment = target / 20;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    counter.textContent = target;
                    clearInterval(timer);
                } else {
                    counter.textContent = Math.floor(current);
                }
            }, 50);
        }
    });
});
</script>
{% endblock %}
