{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ [{{ role_name }}] - {{ guild.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card bg-dark text-light">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏</h4>
                    <div class="d-flex align-items-center gap-3">
                        <span class="badge bg-success">{{ role_name }}</span>
                        <span class="badge bg-info">{{ guild.name }}</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-success" role="alert">
                        <i class="bi bi-star-fill"></i>
                        <strong>–û—Å–æ–±—ã–µ –ø—Ä–∞–≤–∞:</strong> –ö–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫ —Å —Ä–æ–ª—å—é <strong>{{ role_name }}</strong>, 
                        –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ —á–µ—Ä–µ–∑ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è -->
                    {% if user_events %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card bg-secondary">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="bi bi-calendar-event"></i> –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        {% for event in user_events %}
                                        <div class="col-md-6 col-lg-4">
                                            <div class="card bg-dark h-100">
                                                <div class="card-body p-3">
                                                    <h6 class="card-title text-truncate">{{ event.title }}</h6>
                                                    <p class="card-text small text-muted mb-2">
                                                        {% if event.time %}
                                                            <i class="bi bi-clock"></i> {{ event.time }}
                                                        {% else %}
                                                            <i class="bi bi-calendar"></i> –ë–µ–∑ –≤—Ä–µ–º–µ–Ω–∏
                                                        {% endif %}
                                                    </p>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <span class="badge {{ 'bg-success' if not event.stopped else 'bg-secondary' }}">
                                                            {{ '–ê–∫—Ç–∏–≤–Ω–æ' if not event.stopped else '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' }}
                                                        </span>
                                                        <div class="btn-group btn-group-sm">
                                                            <a href="/guild/{{ guild.id }}/events/{{ event.id }}" 
                                                               class="btn btn-outline-primary btn-sm">
                                                                <i class="bi bi-eye"></i>
                                                            </a>
                                                            {% if not event.stopped %}
                                                            <a href="/guild/{{ guild.id }}/events/{{ event.id }}/edit" 
                                                               class="btn btn-outline-warning btn-sm">
                                                                <i class="bi bi-pencil"></i>
                                                            </a>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è -->
                    <div class="card bg-secondary">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h5>
                        </div>
                        <div class="card-body">
                            <form action="{{ url_for('create_event_role', guild_id=guild.id, role_id=role_id) }}" method="post" id="eventForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="channel_id" class="form-label">
                                            <i class="bi bi-hash"></i> –ö–∞–Ω–∞–ª –¥–ª—è —Å–æ–±—ã—Ç–∏—è *
                                        </label>
                                        <select class="form-select bg-dark text-light border-secondary" id="channel_id" name="channel_id" required>
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª...</option>
                                            {% for channel in channels %}
                                                <option value="{{ channel.id }}">{{ channel.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="template_select" class="form-label">
                                            <i class="bi bi-lightning"></i> –ë—ã—Å—Ç—Ä—ã–π —à–∞–±–ª–æ–Ω
                                        </label>
                                        <select class="form-select bg-dark text-light border-secondary" id="template_select">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)...</option>
                                            {% for template_name, template_data in templates.items() %}
                                                <option value="{{ template_name }}" 
                                                        data-title="{{ template_data.title or template_name }}"
                                                        data-description="{{ template_data.description or '' }}"
                                                        data-roles="{{ template_data.roles | join('\n') if template_data.roles else '' }}">
                                                    {{ template_name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="title" class="form-label">
                                        <i class="bi bi-type"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è *
                                    </label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                                           id="title" name="title" required maxlength="100"
                                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–µ–π–¥ –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ –∏–ª–∏ –¢—É—Ä–Ω–∏—Ä –ø–æ PvP">
                                    <small class="text-muted">–ë—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫: [{{ role_name }}] –í–∞—à–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</small>
                                </div>

                                <div class="mb-3">
                                    <label for="description" class="form-label">
                                        <i class="bi bi-card-text"></i> –û–ø–∏—Å–∞–Ω–∏–µ
                                    </label>
                                    <textarea class="form-control bg-dark text-light border-secondary" 
                                              id="description" name="description" rows="3"
                                              placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—ã—Ç–∏–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –Ω–∞–≥—Ä–∞–¥—ã..."></textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="time" class="form-label">
                                        <i class="bi bi-clock"></i> –í—Ä–µ–º—è –∏ –¥–∞—Ç–∞
                                    </label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary" 
                                           id="time" name="time"
                                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20:00, –∑–∞–≤—Ç—Ä–∞ –≤ 15:00, –ø—è—Ç–Ω–∏—Ü–∞ 19:00">
                                </div>

                                <div class="mb-4">
                                    <label for="roles" class="form-label">
                                        <i class="bi bi-people"></i> –†–æ–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ *
                                    </label>
                                    <textarea class="form-control bg-dark text-light border-secondary" 
                                              id="roles" name="roles" rows="4" required
                                              placeholder="–¢–∞–Ω–∫&#10;–•–∏–ª–µ—Ä&#10;–î–î 1&#10;–î–î 2&#10;–î–î 3"></textarea>
                                    <small class="text-muted">–ö–∞–∂–¥–∞—è —Ä–æ–ª—å —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</small>
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-success btn-lg">
                                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
                    <div class="mt-4">
                        <div class="d-flex gap-2 flex-wrap">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
                            </a>
                            <a href="/guild/{{ guild.id }}/events" class="btn btn-outline-primary">
                                <i class="bi bi-calendar"></i> –í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–µ—Ä–≤–µ—Ä–∞
                            </a>
                            <a href="/guild/{{ guild.id }}/events/guest" class="btn btn-outline-info">
                                <i class="bi bi-person-plus"></i> –ì–æ—Å—Ç–µ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–ø—Ä–∞–≤–∫–∞ -->
            <div class="card bg-dark text-light mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> –í–∞—à–∏ –æ—Å–æ–±—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center mb-3">
                                <i class="bi bi-star-fill text-warning" style="font-size: 2rem;"></i>
                            </div>
                            <h6>–û—Å–æ–±—ã–µ –ø—Ä–∞–≤–∞</h6>
                            <p class="small text-muted">–î–æ—Å—Ç—É–ø –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –±–ª–∞–≥–æ–¥–∞—Ä—è —Ä–æ–ª–∏ {{ role_name }}</p>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center mb-3">
                                <i class="bi bi-calendar-plus text-success" style="font-size: 2rem;"></i>
                            </div>
                            <h6>–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π</h6>
                            <p class="small text-muted">–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏</p>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center mb-3">
                                <i class="bi bi-gear text-primary" style="font-size: 2rem;"></i>
                            </div>
                            <h6>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h6>
                            <p class="small text-muted">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤–∞–º–∏ —Å–æ–±—ã—Ç–∏–π</p>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center mb-3">
                                <i class="bi bi-bookmark text-info" style="font-size: 2rem;"></i>
                            </div>
                            <h6>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø</h6>
                            <p class="small text-muted">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –∑–∞–∫–ª–∞–¥–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
document.getElementById('template_select').addEventListener('change', function() {
    const option = this.options[this.selectedIndex];
    if (option.value) {
        document.getElementById('title').value = option.dataset.title || '';
        document.getElementById('description').value = option.dataset.description || '';
        document.getElementById('roles').value = option.dataset.roles || '';
    }
});

// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('eventForm').addEventListener('submit', function(e) {
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> –°–æ–∑–¥–∞–Ω–∏–µ...';
    
    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏
    setTimeout(() => {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ';
    }, 5000);
});
</script>
{% endblock %}
